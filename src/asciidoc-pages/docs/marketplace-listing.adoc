= Adoptium Marketplace Product Listing
:description: Adoptium Marketplace Publisher Product Listing Guide
:keywords: adoptium marketplace publisher listing guide
:orgname: Eclipse Adoptium
:lang: en
:page-authors: johno, tellison


== Overview

Adoptium promotes products listed in the marketplace. Each publisher manages a location containing strucutred information about their products. Adoptium regularly updates the marketplace with the information from your product listing.


== Product Listing Schema

// TODO: fix up URL when schema moves to main branch
Your products' listing must adhere to the
https://github.com/adoptium/api.adoptium.net/tree/marketplace/marketplace[marketplace product JSON schema^], and Adoptium provides
https://github.com/adoptium/api.adoptium.net/blob/marketplace/marketplace/adoptium-marketplace-schema-tests/src/test/resources/net/adoptium/marketplace/schema/[examples^]
and
https://github.com/adoptium/api.adoptium.net/tree/marketplace/marketplace/adoptium-marketplace-schema[code^]
to help produce product listing data in the correct format.

// TODO: discuss allowing a Signature: HTTP header approach too/instead.
To ensure that the listing data has been received correctly from you, and has not been modified en route, Adoptium will check the associated signature. The signature must be a Base64-encoded, RSA encrypted, SHA-256 hash of your entire schema file. The signature will be verified using the public key provided in your publisher information. There are a number of
https://opensource.com/article/19/6/cryptography-basics-openssl-part-2[tools^]
and
https://www.baeldung.com/java-digital-signature[code examples^] available to help produce such signatures.


== Product Listing Repositories

=== Nomenclature

A repository consists of three types of files, namely index files, release files and signature files.

 * Index files : describe the location of release files and index files.
 * Release files : contain a list of marketplace products.
 * Signature files : contain a digital signature associated with an Index or Release file
 
=== Simple Product Listing Repository

The simplest product listing repository comprises one index file and one reelase file with associated digital signatures, as follows:

[source, json]
----
/index.json // <1>
/index.json.sha256.sign // <2>
/release.json // <3>
/release.json.sha256.sign // <4>
----
<1> Main product repository index file.
<2> Digital signature for index file <1>.
<3> Product release listing file.
<4> Digital signature for release listing file <2>.


//TODO : Fix up here down

== Example repository layout

```json
/17/jdk_17_0_2_8.json
/17/jdk_17_0_2_8.json.sha256.sign
/17/jdk_17_0_1_12.json
/17/jdk_17_0_1_12.json.sha256.sign
/17/index.json
/17/index.json.sha256.sign
/8/jdk8u312_b07.json
/8/jdk8u312_b07.json.sha256.sign
/8/index.json
/8/index.json.sha256.sign
/index.json
/index.json.sha256.sign
```

Note that although in this example we have created 1 "Release file" for each release, this is not a requirement, a "Release file" may contain multiple releases, and multiple major verions if desired.
i.e if you wished to only have a single Release file you could have:

```json
/release.json
/release.json.sha256.sign
/index.json
/index.json.sha256.sign
```

## Typical Repository read process

1. A URL and public key is provided to the updater (i.e "https://release.adoptium.net/repo")
2. The updater first looks at `index.json` and its signature file.
   - Updater pulls https://release.adoptium.net/repo/index.json
   - Updater pulls https://release.adoptium.net/repo/index.json.sha256.sign
   - `index.json` is validated against `index.json.sha256.sign` and the public key provided. 
3. Further indexes are extracted from `index.json` and step 2 is repeated until all index files have been read
4. Location of release files are then extracted from all indexes.
   - Updater pulls release file
     - https://release.adoptium.net/repo/17/jdk_17_0_2_8.json
   - Updater pulls signature file
     - https://release.adoptium.net/repo/17/jdk_17_0_2_8.json.sha256.sign
   - Release is validated against signature and public key.
   - Release is parsed according to schema and placed into the marketplace
   
## Index Files
Each `release` is considered a relative path from the index files path, i.e if https://release.adoptium.net/repo/17/index.json contained a release of `jdk_17_0_2_8.json`, the path of https://release.adoptium.net/repo/17/jdk_17_0_2_8.json will be examined.

Schema at `<todo>`

```json
{
  "indexes": [
    "8/index.json",
    "11/index.json"
  ],
  "releases": [
      "17/jdk_17_35.json"
  ]
}
```

```json
{
    "indexes": [],
    "releases": [
        "jdk_17_0_2_8.json",
        "jdk_17_0_1_12.json",
        "jdk_17_35.json"
    ]
}
```

## Release Files
May have any arbitrary name as they are linked to from .

Schema at `<todo>`

```json
{
  "releases": [
    {
      "release_link": "https://github.com/adoptium/temurin8-binaries/releases/tag/jdk8u302-b08",
      "release_name": "jdk8u302-b08",
      "timestamp": "2021-07-29T19:22:38Z",
      "binaries": [
        {
          "os": "linux",
          "architecture": "x64",
          "image_type": "debugimage",
          "jvm_impl": "hotspot",
          "package": {
            "name": "OpenJDK8U-debugimage_x64_linux_hotspot_8u302b08.tar.gz",
            "link": "https://github.com/adoptium/temurin8-binaries/releases/download/jdk8u302-b08/OpenJDK8U-debugimage_x64_linux_hotspot_8u302b08.tar.gz",
            "size": 156695698,
            "checksum": "eb860e0656d7fd50437c703ed8f2f68dc6239fcdd8fa8037295570f298994850",
            "checksum_link": "https://github.com/adoptium/temurin8-binaries/releases/download/jdk8u302-b08/OpenJDK8U-debugimage_x64_linux_hotspot_8u302b08.tar.gz.sha256.txt",
            "metadata_link": "https://github.com/adoptium/temurin8-binaries/releases/download/jdk8u302-b08/OpenJDK8U-debugimage_x64_linux_hotspot_8u302b08.tar.gz.json"
          },
          "timestamp": "2021-07-29T19:22:46Z",
          "scm_ref": "jdk8u302-b08",
          "project": "jdk",
          "distribution": "temurin"
        },
        {
          "os": "linux",
          "architecture": "x64",
          "image_type": "jdk",
          "jvm_impl": "hotspot",
          "package": {
            "name": "OpenJDK8U-jdk_x64_linux_hotspot_8u302b08.tar.gz",
            "link": "https://github.com/adoptium/temurin8-binaries/releases/download/jdk8u302-b08/OpenJDK8U-jdk_x64_linux_hotspot_8u302b08.tar.gz",
            "size": 102954777,
            "checksum": "cc13f274becf9dd5517b6be583632819dfd4dd81e524b5c1b4f406bdaf0e063a",
            "checksum_link": "https://github.com/adoptium/temurin8-binaries/releases/download/jdk8u302-b08/OpenJDK8U-jdk_x64_linux_hotspot_8u302b08.tar.gz.sha256.txt",
            "metadata_link": "https://github.com/adoptium/temurin8-binaries/releases/download/jdk8u302-b08/OpenJDK8U-jdk_x64_linux_hotspot_8u302b08.tar.gz.json"
          },
          "timestamp": "2021-07-29T19:22:53Z",
          "scm_ref": "jdk8u302-b08",
          "project": "jdk",
          "distribution": "temurin"
        }
      ],
      "vendor": "adoptium",
      "version_data": {
        "major": 8,
        "minor": 0,
        "security": 302,
        "patch": null,
        "pre": null,
        "build": 8,
        "optional": null,
        "openjdk_version": "1.8.0_302-b08"
      }
    }
  ]
}
```

### Signature file

Signature files are base64 encoded SHA256 signatures. 

Example of generating, validating and encoding signature

```shell
# Generate signature
openssl dgst -sha256 -sign private.pem -out index.json.sig index.json
# Verify
openssl dgst -sha256 -verify public.pem -signature index.json.sig index.json
#Base64 encode for publishing
cat index.json.sig | base64 -w 0 > index.json.sha256.sign
```
